"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8146],{68146:function(n,e,t){t.d(e,{Pe:function(){return k},Qj:function(){return N},ZP:function(){return y}});var r=t(47568),a=t(41799),i=t(69396),s=t(20414),o=t(85893),u=t(67294),c=t(87536),l=t(41664),d=t.n(l),f=t(94184),m=t.n(f),h=t(33299),p=t(43312),b=t(29829),g=t(55560),v=t(52618),x=t(81758);function y(n){var e=n.parentName,t=n.parentUuid,r=n.onSuccess,a=(0,h.useSession)(),i=(0,u.useState)("initial"),s=i[0],c=i[1],l=(0,u.useState)(),d=l[0],f=l[1];(0,u.useEffect)((function(){"unauthenticated"===a.status&&(0,h.signIn)("auth0"),"authenticated"===a.status&&c("data-entry")}),[a]);var m,p;return(0,o.jsxs)("div",{className:"dialog-form-default",children:["authenticated"!==a.status&&(0,o.jsx)("div",{children:"Checking authorization..."}),"data-entry"===s&&(0,o.jsx)(j,{parentName:e,parentUuid:t,onSuccess:function(n){f(n),c("confirm"),null!=r&&r()}}),"confirm"===s&&(0,o.jsx)(A,{areaId:null!==(m=null===d||void 0===d?void 0:d.uuid)&&void 0!==m?m:"",areaName:null!==(p=null===d||void 0===d?void 0:d.areaName)&&void 0!==p?p:"",onAddMore:function(){return c("data-entry")}})]})}var j=function(n){var e,t,l=n.parentUuid,d=n.parentName,f=n.onSuccess,p=(0,h.useSession)(),b=(0,v.Z)({areaId:l,accessToken:null!==(t=null===p||void 0===p||null===(e=p.data)||void 0===e?void 0:e.accessToken)&&void 0!==t?t:"",onAddCompleted:f}).addOneAreaCmd,y=(0,c.cI)({mode:"onSubmit",defaultValues:{newAreaName:"",shortCode:"",parentName:d}}),j=y.handleSubmit,A=y.formState,N=A.isSubmitting,C=A.isSubmitSuccessful,k=y.setFocus,w=function(){var n=(0,r.Z)((function(n){var e,t,r,a,i;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return e=n.newAreaName,t=n.areaType,r=(0,x.areaDesignationToDb)(t),a=r.isBoulder,i=r.isLeaf,[4,b({name:e,parentUuid:l,isBoulder:a,isLeaf:i})];case 1:return s.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}();return(0,u.useEffect)((function(){k("newAreaName")}),[]),(0,o.jsx)(c.RV,(0,i.Z)((0,a.Z)({},y),{children:(0,o.jsxs)("form",{onSubmit:j(w),children:[(0,o.jsx)(g.ZP,{label:"Parent:",name:"parentName",disabled:!0}),(0,o.jsx)(g.ZP,{label:"Name: *",name:"newAreaName",placeholder:"New area name",registerOptions:{validate:{areNameValidator:function(n){if(null==n)return"minimum 2 letters.";var e=n.trim().length;return e<2?"Minimum 2 letters.":e>3500?"Too long.  Maximuim 3500 letters.":null!=n.trim().match(/^[@%\\^\\&\\(\\)\\-\\+\\=\\~\\`]/)?"First letter can't be: @ % ^ & ( ) - + = ~ `":void 0}}}}),(0,o.jsx)(x.AreaDesignationRadioGroup,{disabled:!1}),(0,o.jsx)("button",{disabled:C||N,className:m()("mt-12 btn btn-primary w-full",N?"btn-disabled":""),type:"submit",children:"Add area"})]})}))},A=function(n){var e=n.areaId,t=n.areaName,r=n.onAddMore,a=(0,u.useRef)();return(0,u.useEffect)((function(){var n;null===(n=a.current)||void 0===n||n.focus()})),(0,o.jsxs)("div",{className:"fadeinEffect flex flex-col items-center justify-center gap-4",children:[(0,o.jsx)(p.Z,{className:"stroke-success w-10 h-10"}),(0,o.jsxs)("div",{className:"text-center",children:["Area\xa0",(0,o.jsx)(C,{uuid:e,children:(0,o.jsx)("span",{className:"font-semibold link-accent",children:t})})," added.  Thank you for your contribution!"]}),(0,o.jsxs)("div",{className:"mt-16 md:mt-8 flex items-center justify-center gap-2 flex-wrap",children:[(0,o.jsx)("button",{type:"button",className:"btn btn-solid btn-wide",onClick:r,ref:a,children:"Add more"}),(0,o.jsx)(C,{uuid:e,children:(0,o.jsx)("button",{className:"btn btn-link",children:"View area"})})]})]})},N=function(n){var e=n.areaName,t=n.uuid,r=n.onContinue;return(0,o.jsxs)(b.Ik,{description:(0,o.jsxs)("span",{children:["Area\xa0",(0,o.jsx)(C,{uuid:t,children:(0,o.jsx)("span",{className:"font-semibold link-accent",children:e})})," added.  Thank you for your contribution!"]}),children:[(0,o.jsx)(b.qs,{className:"btn btn-solid btn-sm",onClick:r,children:"Add more"}),(0,o.jsx)(C,{uuid:t,children:(0,o.jsx)("button",{className:"btn btn-outline btn-sm",children:"View area"})})]})},C=function(n){var e=n.uuid,t=n.children;return(0,o.jsx)(d(),{href:"/areas/".concat(e),children:(0,o.jsx)("a",{target:"_blank",rel:"noreferrer",onClick:function(n){return n.stopPropagation()},children:t})})},k=function(n){var e=n.message;return(0,o.jsx)(b.hW,{description:(0,o.jsxs)("span",{children:[w(e),(0,o.jsxs)("span",{children:[(0,o.jsx)("br",{}),"Click Ok and try again."]})]})})},w=function(n){return console.log("#error",n),n.startsWith("E11000")?"An area with the same name already exists.":n}},81758:function(n,e,t){t.r(e),t.d(e,{AreaDesignationRadioGroup:function(){return o},ExplainAreaTypeLockTooltip:function(){return u},areaDesignationToDb:function(){return l},areaDesignationToForm:function(){return c}});var r=t(85893),a=t(83141),i=t(74066),s=t(41544),o=function(n){var e=n.name,t=void 0===e?"areaType":e,a=n.disabled,s=void 0!==a&&a;return(0,r.jsx)(i.Ee,{groupLabel:"Area designation",groupLabelAlt:(0,r.jsx)(u,{canEdit:!s}),name:t,disabled:s,labels:["Area","Crag (sport, trad, ice)","Boulder"],values:["area","crag","boulder"],labelTips:["Group other areas.","List rope climbing routes.","List boulder problems."],requiredErrorMessage:"Please select an area type"})},u=function(n){return n.canEdit?null:(0,r.jsx)(s.Z,{content:"Read only when the area has climbs or contains other areas",children:(0,r.jsx)(a.Z,{className:"text-info w-5 h-5"})})},c=function(n){var e=n.isBoulder,t=n.leaf;return e?"boulder":t?"crag":"area"},l=function(n){switch(n){case"boulder":return{isLeaf:!0,isBoulder:!0};case"crag":return{isLeaf:!0,isBoulder:!1};default:return{isLeaf:!1,isBoulder:!1}}}},41544:function(n,e,t){t.d(e,{Z:function(){return i}});var r=t(85893),a=t(91347);function i(n){var e=n.content,t=n.enabled,i=void 0===t||t,s=n.className,o=void 0===s?"":s,u=n.children;return(0,r.jsxs)(a.fC,{children:[(0,r.jsx)(a.xz,{className:o,children:u}),i&&(0,r.jsxs)(a.VY,{className:"z-20 text-sm text-base-300 bg-tooltip rounded-md p-2 drop-shadow-lg border max-w-[300px] focus:outline-none",side:"top",align:"start",alignOffset:-40,collisionPadding:8,children:[e,(0,r.jsx)(a.Eh,{className:"stroke-tooltip fill-tooltip"})]})]})}},52618:function(n,e,t){t.d(e,{Z:function(){return j},g:function(){return A}});var r=t(47568),a=t(41799),i=t(69396),s=t(99534),o=t(828),u=t(20414),c=t(37887),l=t(50319),d=t(22920),f=t(26600),m=t(21239),h=t(7297),p=t(91123),b=t(98959),g=t(6591);function v(){var n=(0,h.Z)(["\n  ","\n  ","\n  ","\n  ","\n  query ($uuid: ID) {\n    area(uuid: $uuid) {\n      id\n      uuid\n      areaName\n      gradeContext\n      media {\n        ... MediaWithTagsFields\n      }\n      totalClimbs\n      aggregate {\n        byGrade {\n          count\n          label\n        }\n        byDiscipline {\n            sport {\n              total\n            }\n            trad {\n              total\n            }\n            boulder {\n              total\n            }\n            aid {\n              total\n            }\n          }\n      }\n      metadata {\n        areaId\n        leaf\n        isBoulder\n        lat\n        lng \n        leftRightIndex\n      }\n      pathTokens  \n      ancestors\n      organizations {\n        orgId\n        orgType\n        associatedAreaIds\n        displayName\n        content {\n          description\n          donationLink\n          email\n          facebookLink\n          hardwareReportLink\n          instagramLink\n          website\n        }\n      }\n      climbs {\n        id\n        name\n        fa\n        grades {\n          ...ClimbDisciplineFields\n        }\n        safety\n        type {\n          trad\n          tr\n          sport\n          mixed\n          bouldering\n          alpine\n          aid\n        }\n        metadata {\n          climbId\n          leftRightIndex\n        }\n        content {\n          description\n        }\n      }\n      children {\n        uuid\n        areaName\n        totalClimbs\n        metadata {\n          leaf\n          isBoulder\n          leftRightIndex\n          lat\n          lng\n        }\n        children {\n          uuid\n        }\n      }\n      content {\n        description \n      }\n      authorMetadata {\n        ... AuthorMetadataFields\n      }\n    }\n    getAreaHistory(filter: {areaId: $uuid}) {\n       ...ChangeHistoryFields\n    }\n  }\n  "]);return v=function(){return n},n}function x(){var n=(0,h.Z)(["\n","\n","\nquery AreaByID($uuid: ID) {\n  area(uuid: $uuid) {\n    id\n    uuid\n    areaName\n    gradeContext\n    media {\n      ... MediaWithTagsFields\n    }\n    metadata {\n      areaId\n      leaf\n      isBoulder\n      lat\n      lng \n      leftRightIndex\n    }\n    pathTokens  \n    ancestors\n    totalClimbs\n    climbs {\n      id\n      name\n      fa\n      grades {\n        ...ClimbDisciplineFields\n      }\n      safety\n      type {\n        trad\n        tr\n        sport\n        mixed\n        bouldering\n        alpine\n        aid\n      }\n      metadata {\n        climbId\n        leftRightIndex\n      }\n      content {\n        description\n      }\n    }\n    children {\n      uuid\n      areaName\n      totalClimbs\n      children {\n        uuid\n      }\n      climbs {\n        id\n      }\n      metadata {\n        leaf\n        isBoulder\n      }\n    }\n    content {\n      description \n    } \n  }\n}"]);return x=function(){return n},n}(0,p.Ps)(v(),g.G,m.Mo,b._N,m.WX);var y=(0,p.Ps)(x(),g.G,b._N);function j(n){var e=n.areaId,t=n.accessToken,h=void 0===t?"":t,p=(0,s.Z)(n,["areaId","accessToken"]),b=p.onUpdateCompleted,g=p.onUpdateError,v=p.onAddCompleted,x=p.onAddError,j=p.onDeleteCompleted,N=p.onDeleteError,C=(0,o.Z)((0,l.D)(m.hB,{client:f.Si,onCompleted:function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(t){switch(t.label){case 0:return d.Am.info("Area updated successfully \u2714\ufe0f"),[4,A("/api/revalidate?s=".concat(e))];case 1:return t.sent(),null!=b&&b(n),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),onError:function(n){d.Am.error("Unexpected error: ".concat(n.message)),null!=g&&g(n)}}),1),k=C[0],w=function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(t){switch(t.label){case 0:return[4,k({variables:(0,i.Z)((0,a.Z)({},n),{uuid:e}),context:{headers:{authorization:"Bearer ".concat(h)}}})];case 1:return t.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),Z=(0,o.Z)((0,l.D)(m.pw,{client:f.Si,onCompleted:function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return[4,A("/api/revalidate?s=".concat(e))];case 1:return n.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),onError:function(n){d.Am.error("Unexpected error: ".concat(n.message))}}),1),_=Z[0],I=function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(e){switch(e.label){case 0:return[4,_({variables:{input:n},context:{headers:{authorization:"Bearer ".concat(h)}}})];case 1:return e.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),B=(0,o.Z)((0,l.D)(m.WB,{client:f.Si,onCompleted:function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(t){switch(t.label){case 0:return null!=v&&v(n.addArea),d.Am.info("Area added \ud83d\udd25"),[4,A("/api/revalidate?s=".concat(n.addArea.uuid))];case 1:return t.sent(),[4,A("/api/revalidate?s=".concat(e))];case 2:return t.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),onError:function(n){d.Am.error("Unexpected error: ".concat(n.message)),null!=x&&x(n)}}),1),E=B[0],S=function(){var n=(0,r.Z)((function(n){var e,t,r,i;return(0,u.__generator)(this,(function(s){switch(s.label){case 0:return e=n.name,t=n.parentUuid,r=n.isBoulder,i=n.isLeaf,[4,E({variables:(0,a.Z)({name:e,parentUuid:t},null!=r&&{isBoulder:r},null!=i&&{isLeaf:i}),context:{headers:{authorization:"Bearer ".concat(h)}}})];case 1:return s.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),T=(0,o.Z)((0,l.D)(m.RA,{client:f.Si,onCompleted:function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(t){switch(t.label){case 0:return[4,A("/api/revalidate?s=".concat(e))];case 1:return t.sent(),null!=j&&j(n),[2]}}))}));return function(e){return n.apply(this,arguments)}}(),onError:function(n){d.Am.error("Unexpected error: ".concat(n.message)),null!=N&&N(n)},fetchPolicy:"no-cache"}),1),D=T[0],L=function(){var n=(0,r.Z)((function(n){var e;return(0,u.__generator)(this,(function(t){switch(t.label){case 0:return e=n.uuid,[4,D({variables:{uuid:e},context:{headers:{authorization:"Bearer ".concat(h)}}})];case 1:return t.sent(),[2]}}))}));return function(e){return n.apply(this,arguments)}}();return{updateOneAreaCmd:w,addOneAreaCmd:S,deleteOneAreaCmd:L,getAreaByIdCmd:function(n){var t=n.skip,r=void 0!==t&&t;return(0,c.a)(y,{client:f.Si,variables:{uuid:e},fetchPolicy:"no-cache",ssr:!1,skip:r})},updateAreasSortingOrderCmd:I}}var A=function(){var n=(0,r.Z)((function(n){return(0,u.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,fetch(n)];case 1:return e.sent(),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}}))}));return function(e){return n.apply(this,arguments)}}()}}]);